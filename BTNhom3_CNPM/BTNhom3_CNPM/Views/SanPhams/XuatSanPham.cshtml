@model IEnumerable<BTNhom3_CNPM.Models.SanPham>

@{
    Layout = "~/Views/Shared/Layout_Admin.cshtml";
}

<!DOCTYPE html>
<main id="main" class="main">
    <div class="pagetitle">
        <h1>Thống Kê</h1>
    </div><!-- End Page Title -->
    <section class="section">
        <div class="row">
            <div class="col-lg-12">

                <div class="card">
                    <div class="card-body">
                        <div>
                            <meta charset="UTF-8">
                            <meta http-equiv="X-UA-Compatible" content="IE=edge">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
                            <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.3/css/buttons.dataTables.min.css">

                            <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
                            <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
                            <script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
                            <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
                            <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
                            <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
                            <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js"></script>
                            <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.print.min.js"></script>
                            <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.colVis.min.js"></script>
                            <script src="https://cdn.datatables.net/select/1.4.0/js/dataTables.select.min.js"></script>

                            <br />
                            <script>
                                $(document).ready(function () {
                                    var sum = 0;
                                    $('#example').DataTable({

                                        "language": {
                                            "lengthMenu": " _MENU_ ",
                                            "zeroRecords": "Không tìm thấy",
                                            "info": "Hiển thị trang _PAGE_ / _PAGES_",
                                            "infoEmpty": "Không có dữ liệu",
                                            "infoFiltered": "(Được lọc từ _MAX_ mục)",
                                            "search": "Tìm kiếm:",
                                            "paginate": {
                                                "first": "Trang đầu",
                                                "last": "Trang cuối",
                                                "next": "Sau",
                                                "previous": "Trước"
                                            },
                                            buttons: {
                                                colvis: 'Chọn mục không xuất'
                                            },
                                            select: {
                                                rows: " (%d dòng được chọn)"
                                            }
                                        },
                                        dom: 'Blfrtip',
                                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],

                                        buttons: [
                                            {
                                                extend: 'print',
                                                footer: true,
                                                exportOptions: {
                                                    columns: ':visible'
                                                }
                                            },
                                            {
                                                extend: 'csvHtml5',
                                                footer: true,
                                                exportOptions: {
                                                    columns: ':visible'
                                                }
                                            },
                                            {
                                                extend: 'copyHtml5',
                                                footer: true,
                                                exportOptions: {
                                                    columns: ':visible'
                                                }
                                            },
                                            {
                                                extend: 'excelHtml5',
                                                footer: true,
                                                exportOptions: {
                                                    columns: ':visible'
                                                }
                                            },
                                            {
                                                extend: 'pdfHtml5',
                                                footer: true,
                                                exportOptions: {
                                                    columns: ':visible'
                                                }
                                            },
                                            'colvis'
                                        ],
                                        footerCallback: function (row, data, start, end, display) {
                                            var api = this.api(), data;

                                            // Remove the formatting to get integer data for summation
                                            var intVal = function (i) {
                                                return typeof i === 'string' ? i * 1 : typeof i === 'number' ? i : 0;
                                            };

                                            // Total over all pages
                                            total = api
                                                .column(5)
                                                .data()
                                                .reduce(function (a, b) {
                                                    return intVal(a) + intVal(b);
                                                }, 0);

                                            // Total over this page
                                            pageTotal = api
                                                .column(5, { page: 'current' })
                                                .data()
                                                .reduce(function (a, b) {
                                                    return intVal(a) + intVal(b);
                                                }, 0);

                                            // Update footer
                                            $(api.column(5).footer()).html(pageTotal + ' VNĐ' + ' (Toàn bộ: ' + total + ' VNĐ)');
                                        },
                                    });

                                    $("#example tbody").on("click", "tr", function () {
                                        var price = parseInt(
                                            $(this).find("td").eq(5).html()
                                        );
                                        if ($(this).hasClass("selected")) {
                                            sum -= price;
                                        } else {
                                            sum += price;
                                        }
                                        $(".sum").html(sum + " VNĐ");
                                        $(this).toggleClass("selected");
                                    });
                                });
                            </script>

                        </div>

                        <table class="display nowrap" style="width:100%" id="example">
                            <thead class="thead-dark">
                                <tr>
                                    <th>Mã sản phẩm</th>
                                    <th>Tên nhà cung cấp</th>
                                    <th>Tên loại</th>
                                    <th>Tên sản phẩm</th>
                                    <th>Mô tả sản phẩm</th>

                                    <th>Đơn giá</th>
                                    <th>Đơn vị tính</th>
                                </tr>
                            </thead>

                            <tfoot>
                                <tr>
                                    <th>Tổng tiền chọn:</th>
                                    <th class="sum">??? VNĐ</th>
                                    <th colspan="3" style="text-align: right">Total:</th>
                                    <th></th>
                                </tr>
                            </tfoot>

                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.MaSP)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.NCC.TenNCC)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Loai.TenLoai)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.TenSP)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.MoTaSP)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.DonGia).ToHtmlString()
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.DonViTinh)
                                        </td>

                                    </tr>
                                }
                            </tbody>
                            
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>



